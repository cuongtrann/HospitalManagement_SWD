@page
@model HospitalManagement.Pages.Recieptionist.AddAppointmentModel
@{
}
<h1><i class="fa-regular fa-calendar-check mx-2"></i>Appointment Management</h1>
<div class="card w-1"></div>
<h2 class="mt-2">Patient Information</h2>
<div class="row mt-3">
    <div class="col-md-4 row">
        <form asp-page-handler="Filter" method="get">
        <div class="input-group mb-3">
            
                <input asp-for="@Model.KeyWord" name="keyword" id="patientSearch" type="text" class="form-control" placeholder="Search patient">
                <div class="input-group-append">
                    <button id="searchButton" class="btn btn-outline-primary" type="submit">Search</button>
                </div>
            
        </div>
        </form>
        <div class="input-group mb-3">
            <div>
                <select class="form-control" id="sortSelect">
                    <option>Sort by default</option>
                    <option>Option 2</option>
                    <option>Option 3</option>
                    <option>Option 4</option>
                    <option>Option 5</option>
                </select>
            </div>
        </div>
    </div>
    <div>
        <button class="btn btn-outline-primary float-end" style="margin-right:70px"><i class="fa-solid fa-user-plus fa-beat mx-2"></i>Add new patient</button>
    </div>
    <div class="row mt-3">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Fullname</th>
                    <th>Gender</th>
                    <th>Id number</th>
                    <th>Date of birth</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Address</th>
                    <th>Department</th>
                    <th></th>

                </tr>
            </thead>
            <tbody>
                @{
                    int i = (Model.CurrentPage -1) * 5 + 1;
                }
                
                @foreach (var patient in Model.PatientsPerPage)
                {
                    string gender = (bool)patient.Profile.Gender ? "Male" : "Female";
                    string dobStr = patient.Profile.Dob?.ToString("dd/MM/yyyy");
                    <tr>
                        <td>@i</td>
                        <td>@patient.Profile.Name</td>
                        <td>@gender</td>
                        <td>@patient.Profile.IdNo</td>
                        <td>@dobStr</td>
                        <td>@patient.Profile.Phone</td>
                        <td>@patient.Profile.Email</td>
                        <td>@patient.Profile.Address</td>
                        <td>
                            <select class="form-control" id="departmentSelect">
                                <option>Select department</option>
                                @foreach (var depart in Model.Departments)
                                {
                                    <option value="@depart.Id">@depart.Name</option>
                                }
                            </select>
                        </td>
                        <td><button class="btn btn-outline-primary"><i class="fa-regular fa-calendar-check fa-beat mx-2"></i> Add appointment</button></td>
                    </tr>
                    i++;
                }
            </tbody>
        </table>
        <div class="px-5">
        </div>
        <div class="col-md-8 mx-auto">
            <nav>
                <ul class="pagination justify-content-center">
                    @for (int p = 1; p <= Model.TotalPage; p++)
                    {
                        if (p == Model.CurrentPage)
                        {
                            <li id="currentPage" class="page-item active"><a href="#" class="page-link">@p</a></li>

                        }
                        else
                        {
                            <li class="page-item"><a class="page-link" asp-route-id ="@p" asp-page-handler="Filter">@p</a></li>
                        }
                    }
                </ul>
            </nav>
        </div>
        <div>
        </div>
    </div>

</div>

@*<script>
    function loadPatientFilter(sortOption, page, keyword) {
        $.ajax({
            url: '/Recieptionist/AddAppointment?handler=Filter',
            type: 'GET',
            data: { sortOption: sortOption, selectedPage: page, keyword: keyword },
            success: function (data) {

            },
            error: function (xhr, status, error) {
                console.log(xhr.responseText);
            }
        });
    }



    $(document).ready(function () {




        // Lắng nghe sự kiện onchange của các select box và input
        $('#sortSelect').on('change', function () {
            var searchKeyword = $('#patientSearch').val();
            var sortOption = $('#sortSelect').val();
            var page = $('#currentPage').val();
            if (!page) {
                page = 1;
            }
            loadPatientFilter(sortOption, page, searchKeyword);
        });
    });

    // Lắng nghe sự kiện click của các nút phân trang
    $(document).on('click', '.pagination a', function (event) {
        event.preventDefault();
        var searchKeyword = $('#patientSearch').val();
        var page = $(this).data('page');
        if (!page) {
            page = 1;
        }
        var sortOption = $('#sortSelect').val();
        loadPatientFilter(sortOption, page, searchKeyword);
        location.reload();
    });

    $(document).on('click', '#searchButton', function () {
        var searchKeyword = $('#patientSearch').val();
        var page = $(this).data('page');
        if (!page) {
            page = 1;
        }

        var sortOption = $('#sortSelect').val();
        loadPatientFilter(sortOption, page, searchKeyword);

    });
</script>*@